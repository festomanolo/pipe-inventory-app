<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics - Pipe Inventory Management</title>
    <!-- Bootstrap CSS -->
    <link href="../../node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome Icons - Updated with SRI for Windows compatibility -->
  <!-- Custom Fonts -->
  <link rel="stylesheet" href="css/font.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <!-- Chart.js - Using reliable CDN with SRI for Windows compatibility -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js" integrity="sha256-+8RZJua0aEWg+QVVKg4LEzEEm/8RFez5Tb4JBNiV5xA=" crossorigin="anonymous"></script>
    <!-- AOS Animation Library -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../../public/assets/css/style.css">
    <style>
        /* Analytics specific styles */
        .analytics-card {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .analytics-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
            padding: 20px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.02);
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 10px 0;
            background: linear-gradient(45deg, #4cc9f0, #4361ee);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .recommendation-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #4361ee;
            transition: all 0.3s ease;
        }

        .recommendation-card:hover {
            transform: translateX(5px);
            background: rgba(255, 255, 255, 0.1);
        }

        .trend-indicator {
            display: inline-flex;
            align-items: center;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .trend-up {
            background: rgba(76, 201, 240, 0.2);
            color: #4cc9f0;
        }

        .trend-down {
            background: rgba(233, 69, 96, 0.2);
            color: #e94560;
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #fff;
        }

        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        @keyframes chartReveal {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .chart-reveal {
            animation: chartReveal 0.5s ease-out forwards;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(26, 26, 46, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid #4361ee;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        /* About section styling imported from other pages */
        .profile-card {
          background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
          border-radius: 15px;
          overflow: hidden;
          box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
          transition: all 0.3s ease;
          animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
        }
        
        .profile-header {
          padding: 30px;
          text-align: center;
          position: relative;
          background: linear-gradient(45deg, #0f3460 0%, #e94560 100%);
          color: white;
        }
        
        .profile-img-container {
          width: 120px;
          height: 120px;
          margin: 0 auto 15px;
          border-radius: 50%;
          padding: 5px;
          background: linear-gradient(45deg, #4cc9f0, #4361ee);
          animation: pulse 2s infinite;
        }
        
        .profile-img {
          width: 100%;
          height: 100%;
          object-fit: cover;
          border-radius: 50%;
          border: 3px solid #fff;
        }
        
        .profile-name {
          font-size: 28px;
          font-weight: 700;
          margin: 10px 0 5px;
          animation: slideUp 0.5s 0.2s both;
        }
        
        .profile-title {
          font-size: 16px;
          opacity: 0.9;
          margin-bottom: 5px;
          animation: slideUp 0.5s 0.3s both;
        }
        
        .profile-subtitle {
          font-size: 14px;
          opacity: 0.7;
          animation: slideUp 0.5s 0.4s both;
        }
        
        @keyframes slideUp {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
        }
        
        .contact-cards {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
          gap: 15px;
          padding: 20px;
        }
        
        .contact-card {
          display: flex;
          align-items: center;
          padding: 15px;
          border-radius: 10px;
          transition: all 0.3s ease;
          animation: fadeIn 0.5s ease-out forwards;
          opacity: 0;
          color: white;
        }
        
        .whatsapp-card {
          background: linear-gradient(to right, #128C7E, #075E54);
          animation-delay: 0.5s;
        }
        
        .github-card {
          background: linear-gradient(to right, #333333, #24292e);
          animation-delay: 0.6s;
        }
        
        .website-card {
          background: linear-gradient(to right, #4361ee, #3a0ca3);
          animation-delay: 0.7s;
        }
        
        .contact-card:hover {
          transform: translateY(-5px);
          box-shadow: 0 7px 15px rgba(0, 0, 0, 0.3);
        }
        
        .card-icon {
          width: 40px;
          height: 40px;
          display: flex;
          align-items: center;
          justify-content: center;
          border-radius: 50%;
          background: rgba(255, 255, 255, 0.2);
          margin-right: 15px;
          font-size: 20px;
        }
        
        .card-content h6 {
          margin: 0 0 5px;
          font-weight: 600;
        }
        
        .card-content a {
          color: rgba(255, 255, 255, 0.9);
          text-decoration: none;
          transition: color 0.2s;
        }
        
        .card-content a:hover {
          color: white;
          text-decoration: underline;
        }
        
        .about-footer {
          padding: 20px;
          text-align: center;
          border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .tech-stack {
          display: flex;
          flex-wrap: wrap;
          justify-content: center;
          gap: 10px;
          margin-bottom: 15px;
        }
        
        .tech-badge {
          padding: 5px 10px;
          border-radius: 20px;
          font-size: 12px;
          background: linear-gradient(to right, #0f3460, #16213e);
          color: white;
          animation: fadeIn 0.5s 0.8s both;
        }
        
        .copyright {
          font-size: 12px;
          color: rgba(255, 255, 255, 0.6);
          margin: 0;
          animation: fadeIn 0.5s 0.9s both;
        }
        
        @keyframes pulse {
          0% {
            box-shadow: 0 0 0 0 rgba(76, 201, 240, 0.7);
          }
          70% {
            box-shadow: 0 0 0 10px rgba(76, 201, 240, 0);
          }
          100% {
            box-shadow: 0 0 0 0 rgba(76, 201, 240, 0);
          }
        }
    </style>
  </head>
<body>
    <!-- Mobile Toggle Button -->
    <button class="toggle-sidebar" id="toggleSidebar">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar Navigation -->
    <nav class="sidebar">
        <div class="sidebar-header">
            <img src="../../../logo.png" id="analytics-sidebar-logo" alt="Eliva Hardware Logo" style="width: 50px; height: auto; margin-right: 10px;" onerror="this.src='../../public/assets/images/logo.png';">
            <h3>Eliva Hardware</h3>
        </div>
        <ul class="sidebar-nav">
            <li>
                <a href="dashboard.html">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li>
                <a href="inventory.html">
                    <i class="fas fa-boxes"></i>
                    <span>Inventory</span>
                    <span class="alert-badge" id="alert-count">0</span>
                </a>
            </li>
            <li>
                <a href="sales.html">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Sales</span>
                </a>
            </li>
            <li>
                <a href="customers.html">
                    <i class="fas fa-users"></i>
                    <span>Customers</span>
                </a>
            </li>
            <li>
                <a href="reports.html">
                    <i class="fas fa-file-alt"></i>
                    <span>Reports</span>
                </a>
            </li>
            <li>
                <a href="#" class="active">
                    <i class="fas fa-chart-line"></i>
                    <span>Analytics</span>
                </a>
            </li>
            <li>
                <a href="#" data-bs-toggle="modal" data-bs-target="#settingsModal">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </li>
            <li>
                <a href="#" id="logout-link">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </li>
        </ul>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <div class="content-header">
            <h1><i class="fas fa-chart-line me-2"></i> Analytics Dashboard</h1>
            <div class="d-flex align-items-center">
                <div class="btn-group me-3">
                    <button id="export-pdf-btn" class="btn btn-primary btn-sm">
                        <i class="fas fa-file-pdf me-1"></i> Export PDF
                    </button>
                    <button id="export-print-btn" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-print me-1"></i> Print
                    </button>
                </div>
                <select id="time-range" class="form-select form-select-sm d-inline-block w-auto">
                    <option value="7">Last 7 Days</option>
                    <option value="30">Last 30 Days</option>
                    <option value="90">Last 90 Days</option>
                    <option value="365">Last Year</option>
                </select>
            </div>
        </div>

        <!-- Key Metrics -->
        <div class="row mb-4" data-aos="fade-up">
            <div class="col-md-3">
                <div class="metric-card">
                    <i class="fas fa-dollar-sign fa-2x text-primary"></i>
                    <div class="metric-value" id="total-revenue">$0</div>
                    <div class="metric-label">Total Revenue</div>
                    <div class="trend-indicator trend-up">
                        <i class="fas fa-arrow-up"></i>
                        <span>12.5%</span>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card">
                    <i class="fas fa-chart-pie fa-2x text-success"></i>
                    <div class="metric-value" id="profit-margin">0%</div>
                    <div class="metric-label">Profit Margin</div>
                    <div class="trend-indicator trend-up">
                        <i class="fas fa-arrow-up"></i>
                        <span>8.3%</span>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card">
                    <i class="fas fa-box fa-2x text-warning"></i>
                    <div class="metric-value" id="inventory-value">$0</div>
                    <div class="metric-label">Inventory Value</div>
                    <div class="trend-indicator trend-down">
                        <i class="fas fa-arrow-down"></i>
                        <span>3.2%</span>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card">
                    <i class="fas fa-sync fa-2x text-info"></i>
                    <div class="metric-value" id="turnover-rate">0</div>
                    <div class="metric-label">Turnover Rate</div>
                    <div class="trend-indicator trend-up">
                        <i class="fas fa-arrow-up"></i>
                        <span>5.7%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="row mb-4">
            <!-- Sales Trend Chart -->
            <div class="col-md-8" data-aos="fade-right">
                <div class="analytics-card">
                    <div class="card-body">
                        <h5 class="chart-title">Sales Trend</h5>
                        <div class="chart-container">
                            <canvas id="salesTrendChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Product Distribution Chart -->
            <div class="col-md-4" data-aos="fade-left">
                <div class="analytics-card">
                    <div class="card-body">
                        <h5 class="chart-title">Product Distribution</h5>
                        <div class="chart-container">
                            <canvas id="productDistributionChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recommendations and Inventory Health -->
        <div class="row">
            <!-- Recommendations -->
            <div class="col-md-6" data-aos="fade-up">
                <div class="analytics-card">
                    <div class="card-body">
                        <h5 class="chart-title">Smart Recommendations</h5>
                        <div id="recommendations-list">
                            <!-- Recommendations will be populated dynamically -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inventory Health -->
            <div class="col-md-6" data-aos="fade-up">
                <div class="analytics-card">
                    <div class="card-body">
                        <h5 class="chart-title">Inventory Health</h5>
                        <div class="chart-container">
                            <canvas id="inventoryHealthChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Settings Modal -->
    <div class="modal fade" id="settingsModal" tabindex="-1" aria-labelledby="settingsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="settingsModalLabel">
                        <i class="fas fa-cog me-2"></i> Settings
                    </h5>
                    <button type="button" class="btn-close btn-close-red" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Nav tabs -->
                    <ul class="nav nav-tabs mb-3" id="settingsTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab" aria-controls="general" aria-selected="true">General</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="reports-tab" data-bs-toggle="tab" data-bs-target="#reports-settings" type="button" role="tab" aria-controls="reports-settings" aria-selected="false">Daily Reports</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="about-tab" data-bs-toggle="tab" data-bs-target="#about" type="button" role="tab" aria-controls="about" aria-selected="false">About</button>
                        </li>
                    </ul>
                    
                    <!-- Tab content -->
                    <div class="tab-content">
                        <!-- General Settings -->
                        <div class="tab-pane fade show active" id="general" role="tabpanel" aria-labelledby="general-tab">
                            <form id="general-settings-form">
                                <div class="mb-3">
                                    <label for="company-name" class="form-label">Company Name</label>
                                    <input type="text" class="form-control" id="company-name" placeholder="Enter company name">
                                </div>
                                <div class="mb-3">
                                    <label for="alert-threshold" class="form-label">Default Alert Threshold</label>
                                    <input type="number" class="form-control" id="alert-threshold" min="1" value="10">
                                    <small class="form-text text-secondary">Items with quantity below this value will trigger alerts</small>
                                </div>
                                <div class="mb-3">
                                    <label for="currency" class="form-label">Currency</label>
                                    <select class="form-select" id="currency">
                                        <option value="USD">US Dollar ($)</option>
                                        <option value="EUR">Euro (€)</option>
                                        <option value="GBP">British Pound (£)</option>
                                        <option value="TZS">Tanzanian Shilling (TZsh)</option>
                                    </select>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Daily Reports Settings -->
                        <div class="tab-pane fade" id="reports-settings" role="tabpanel" aria-labelledby="reports-tab">
                            <form id="report-settings-form">
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="enable-daily-reports" checked>
                                    <label class="form-check-label text-white" for="enable-daily-reports">Enable Automatic Daily Reports</label>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Generate Reports At</label>
                                    <div class="row">
                                        <div class="col-6">
                                            <select class="form-select" id="report-hour">
                                                <option value="0">12 AM (Midnight)</option>
                                                <option value="1">1 AM</option>
                                                <option value="2">2 AM</option>
                                                <option value="3">3 AM</option>
                                                <option value="4">4 AM</option>
                                                <option value="5">5 AM</option>
                                                <option value="6">6 AM</option>
                                                <option value="7">7 AM</option>
                                                <option value="8">8 AM</option>
                                                <option value="9">9 AM</option>
                                                <option value="10">10 AM</option>
                                                <option value="11">11 AM</option>
                                                <option value="12">12 PM (Noon)</option>
                                                <option value="13">1 PM</option>
                                                <option value="14">2 PM</option>
                                                <option value="15">3 PM</option>
                                                <option value="16">4 PM</option>
                                                <option value="17">5 PM</option>
                                                <option value="18">6 PM</option>
                                                <option value="19">7 PM</option>
                                                <option value="20">8 PM</option>
                                                <option value="21">9 PM</option>
                                                <option value="22">10 PM</option>
                                                <option value="23">11 PM</option>
                                            </select>
                                        </div>
                                        <div class="col-6">
                                            <select class="form-select" id="report-minute">
                                                <option value="0">00</option>
                                                <option value="15">15</option>
                                                <option value="30">30</option>
                                                <option value="45">45</option>
                                            </select>
                                        </div>
                                    </div>
                                    <small class="form-text text-secondary">Reports will be generated daily at this time for the previous day's sales</small>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="report-directory" class="form-label">Save Reports To</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="report-directory" readonly>
                                        <button class="btn btn-outline-secondary" type="button" id="choose-directory">
                                            <i class="fas fa-folder-open"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="show-notifications" checked>
                                    <label class="form-check-label" for="show-notifications">Show Notifications When Reports Are Generated</label>
                                </div>
                            </form>
                        </div>
                        
                        <!-- About Section -->
                        <div class="tab-pane fade" id="about" role="tabpanel" aria-labelledby="about-tab">
                            <div class="text-center py-4">
                                <h4>Pipe Inventory Management System</h4>
                                <p class="text-muted">Version 1.0.0</p>
                                <p>© 2024 Eliva Hardware. All rights reserved.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="save-settings">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Dependencies -->
    <script src="../../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="../utils/localDatabase.js"></script>
    <script src="js/analytics.js"></script>
    <script>
        // Initialize AOS animations
        AOS.init({
            duration: 800,
            easing: 'ease-in-out',
            once: true
        });

        // Initialize sidebar toggle
        document.getElementById('toggleSidebar').addEventListener('click', () => {
            const sidebar = document.querySelector('.sidebar');
            sidebar.classList.toggle('expanded');
        });

        // Show loading overlay
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        // Hide loading overlay
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        // Initialize charts and data when page loads
        document.addEventListener('DOMContentLoaded', async () => {
            showLoading();
            try {
                await initializeAnalytics();
            } catch (error) {
                console.error('Error initializing analytics:', error);
            } finally {
                hideLoading();
            }
        });
    </script>
</body>
</html> 